<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on ç»™æˆ‘ä¸€æ¡é±¼ğŸŸ</title>
		<link>https://wangzeping722.github.io/posts/</link>
		<description>Recent content in Posts on ç»™æˆ‘ä¸€æ¡é±¼ğŸŸ</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>zh</language>
		<copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright>
		<lastBuildDate>Sun, 16 Aug 2020 11:58:45 +0800</lastBuildDate>
		<atom:link href="https://wangzeping722.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>TiDBå­¦ä¹ è¯¾ç¨‹ - week1</title>
			<link>https://wangzeping722.github.io/posts/tidb-hello-transaction-week1/</link>
			<pubDate>Sun, 16 Aug 2020 11:58:45 +0800</pubDate>
			
			<guid>https://wangzeping722.github.io/posts/tidb-hello-transaction-week1/</guid>
			<description>æœ€è¿‘éå¸¸æƒ³å­¦ä¹ å…³äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„çŸ¥è¯†ï¼Œç¢°å·§ TiDB å®˜æ–¹æ¨å‡ºäº†ã€Šé«˜æ€§èƒ½ TiDB ç³»åˆ—è¯¾ç¨‹ã€‹ï¼Œæˆ‘å°±åƒæ¡åˆ°å®ä¸€æ ·é«˜å…´ğŸ˜„å‘€ã€‚å¸Œæœ›èƒ½å¤Ÿé€šè¿‡è¿™æ¬¡çš„è¯¾ç¨‹æœ‰æ‰€æ”¶è·ï¼Œæˆ‘ä¸€å®šä¼š</description>
			<content type="html"><![CDATA[<p>æœ€è¿‘éå¸¸æƒ³å­¦ä¹ å…³äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„çŸ¥è¯†ï¼Œç¢°å·§ TiDB å®˜æ–¹æ¨å‡ºäº†ã€Šé«˜æ€§èƒ½ TiDB ç³»åˆ—è¯¾ç¨‹ã€‹ï¼Œæˆ‘å°±åƒæ¡åˆ°å®ä¸€æ ·é«˜å…´ğŸ˜„å‘€ã€‚å¸Œæœ›èƒ½å¤Ÿé€šè¿‡è¿™æ¬¡çš„è¯¾ç¨‹æœ‰æ‰€æ”¶è·ï¼Œæˆ‘ä¸€å®šä¼šåšæŒå­¦å®Œçš„ã€‚</p>
<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p>æœ¬åœ°ä¸‹è½½ TiDBï¼ŒTiKVï¼ŒPD æºä»£ç ï¼Œæ”¹å†™æºç å¹¶ç¼–è¯‘éƒ¨ç½²ä»¥ä¸‹ç¯å¢ƒï¼š</p>
<ul>
<li>1 TiDB</li>
<li>1 PD</li>
<li>3 TiKVâ€¨</li>
</ul>
<p>æ”¹å†™åï¼šä½¿å¾— TiDB å¯åŠ¨äº‹åŠ¡æ—¶ï¼Œèƒ½æ‰“å°å‡ºä¸€ä¸ª â€œhello transactionâ€ çš„ æ—¥å¿— ã€‚</p>
<h2 id="æºç ç¼–è¯‘">æºç ç¼–è¯‘</h2>
<p>æˆ‘æ˜¯åœ¨æœ¬åœ°ç›´æ¥ç¼–è¯‘è¿è¡Œçš„ï¼Œè¿‡ç¨‹æœ‰äº›ç¹çï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†™ä¸€ä¸ª Dockerfile æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²å•¦ã€‚</p>
<p>è¿™ä¸‰ä¸ªé¡¹ç›®çš„ç¼–è¯‘éƒ½éå¸¸ç®€å•ï¼Œå…ˆæŠŠé¡¹ç›®åˆ†åˆ«æ‹‰ä¸‹æ¥ï¼Œç„¶ååˆ†åˆ«è¿›å…¥æ¯ä¸ªé¡¹ç›®ä¸‹æ‰§è¡Œ make å°±å¯ä»¥ç¼–è¯‘æˆåŠŸã€‚ç¼–è¯‘åäºŒè¿›åˆ¶çš„è·¯å¾„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">pd/bin/
tidb/bin/
tikv/target/debug/
</code></pre></div><h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<p>å‚è€ƒ <a href="https://github.com/tikv/tikv/blob/master/docs/how-to/deploy/using-binary.md">TiKV</a> é›†ç¾¤çš„éƒ¨ç½²æ–¹æ¡ˆå°±å¯ä»¥æŠŠ <code>PD</code> å’Œ <code>TiKV</code> è¿™ä¸¤ä¸ªç»„ä»¶éƒ¨ç½²æˆåŠŸï¼Œç„¶åå†å•ç‹¬éƒ¨ç½²ä¸€ä¸ª <code>TiDB</code> èŠ‚ç‚¹å°±å®Œæˆäº†ä½œä¸šçš„éƒ¨ç½²è¦æ±‚ï¼š</p>
<ol>
<li>
<p>å¯åŠ¨ PD</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">./pd-server --name<span class="o">=</span>pd1 <span class="se">\
</span><span class="se"></span>    --data-dir<span class="o">=</span>pd1 <span class="se">\
</span><span class="se"></span>    --client-urls<span class="o">=</span><span class="s2">&#34;http://127.0.0.1:2379&#34;</span> <span class="se">\
</span><span class="se"></span>    --peer-urls<span class="o">=</span><span class="s2">&#34;http://127.0.0.1:2380&#34;</span> <span class="se">\
</span><span class="se"></span>    --initial-cluster<span class="o">=</span><span class="s2">&#34;pd1=http://127.0.0.1:2380&#34;</span> <span class="se">\
</span><span class="se"></span>    --log-file<span class="o">=</span>pd1.log
</code></pre></div></li>
<li>
<p>å¯åŠ¨ TiKV é›†ç¾¤ï¼šåœ¨éƒ¨ç½² TiKV çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªå°é—®é¢˜ã€å•è¿›ç¨‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¸æ»¡è¶³ TiKV çš„éœ€æ±‚ã€‘ï¼Œæ‰€ä»¥éœ€è¦æ”¹ä¸€ä¸‹ç³»ç»Ÿé…ç½®ï¼ˆMacOSï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦å¤§å°</span>
sudo launchctl limit maxfiles <span class="m">65536</span> <span class="m">200000</span>
   
./tikv-server --pd-endpoints<span class="o">=</span><span class="s2">&#34;127.0.0.1:2379&#34;</span> <span class="se">\
</span><span class="se"></span>    --addr<span class="o">=</span><span class="s2">&#34;127.0.0.1:20160&#34;</span> <span class="se">\
</span><span class="se"></span>    --data-dir<span class="o">=</span>tikv1 <span class="se">\
</span><span class="se"></span>    --log-file<span class="o">=</span>tikv1.log
   
./tikv-server --pd-endpoints<span class="o">=</span><span class="s2">&#34;127.0.0.1:2379&#34;</span> <span class="se">\
</span><span class="se"></span>    --addr<span class="o">=</span><span class="s2">&#34;127.0.0.1:20161&#34;</span> <span class="se">\
</span><span class="se"></span>    --data-dir<span class="o">=</span>tikv2 <span class="se">\
</span><span class="se"></span>    --log-file<span class="o">=</span>tikv2.log
   
./tikv-server --pd-endpoints<span class="o">=</span><span class="s2">&#34;127.0.0.1:2379&#34;</span> <span class="se">\
</span><span class="se"></span>    --addr<span class="o">=</span><span class="s2">&#34;127.0.0.1:20162&#34;</span> <span class="se">\
</span><span class="se"></span>    --data-dir<span class="o">=</span>tikv3 <span class="se">\
</span><span class="se"></span>    --log-file<span class="o">=</span>tikv3.log
</code></pre></div></li>
<li>
<p>å¯åŠ¨ TiDB</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">./tidb-server --store<span class="o">=</span>tikv --path<span class="o">=</span><span class="s1">&#39;127.0.0.1:2379&#39;</span> --log-file<span class="o">=</span>tidb.log
</code></pre></div></li>
</ol>
<p>éƒ¨ç½²å®Œä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹ tidb.log è¿™ä¸ªæ—¥å¿—ï¼Œå‡ºç° <code>server is running MySQL protocol</code> åï¼Œå°±æ˜¯éƒ¨ç½²å®Œæˆå•¦ã€‚</p>
<h3 id="ä¿®æ”¹æºç ">ä¿®æ”¹æºç </h3>
<p>TiDB çš„æºç å¯¹æ–°æ‰‹æ¥è¯´ç®—æ˜¯éå¸¸å‹å¥½çš„äº†ï¼Œå¯ä»¥ä»<code>tidb-server</code>ä¸­çš„ main å‡½æ•°å¼€å§‹ä¸€è·¯è¿½è¸ªåˆ°è¿æ¥å»ºç«‹å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„ä»£ç ï¼Œç®€å•æ˜“æ‡‚ã€‚ä¸‹é¢ç»™å‡ºæµç¨‹ï¼Œå…·ä½“çš„ä»¥åæ‰¾ä¸ªæ—¶é—´åˆ†æåˆ†æï¼š</p>
<p>ç›´åˆ°é‡åˆ°äº†<code>session.go</code>ä¸­çš„è¿™æ®µä»£ç ï¼ŒåŠ ä¸Šæ—¥å¿—å°±ç®—å¤§åŠŸå‘Šæˆå•¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// InitTxnWithStartTS create a transaction with startTS.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">session</span><span class="p">)</span> <span class="nf">InitTxnWithStartTS</span><span class="p">(</span><span class="nx">startTS</span> <span class="kt">uint64</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">s</span><span class="p">.</span><span class="nx">txn</span><span class="p">.</span><span class="nf">Valid</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span>
	<span class="p">}</span>

	<span class="c1">// no need to get txn from txnFutureCh since txn should init with startTs
</span><span class="c1"></span>  <span class="nx">logutil</span><span class="p">.</span><span class="nf">BgLogger</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;hello transaction&#34;</span><span class="p">)</span>
	<span class="nx">txn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nf">BeginWithStartTS</span><span class="p">(</span><span class="nx">startTS</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="nx">txn</span><span class="p">.</span><span class="nf">SetVars</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">sessionVars</span><span class="p">.</span><span class="nx">KVVars</span><span class="p">)</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">txn</span><span class="p">.</span><span class="nf">changeInvalidToValid</span><span class="p">(</span><span class="nx">txn</span><span class="p">)</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">loadCommonGlobalVariablesIfNeeded</span><span class="p">(</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div><p>é‡æ–°ç¼–è¯‘è¿è¡Œ TiDBï¼Œä½ è¿˜ä¼šå‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„ç°è±¡ï¼Œé‚£å°±æ˜¯ç¨‹åºä¼šç‹‚æ‰“ <code>hello transaction</code>ï¼Œè¿™æ˜¯å› ä¸º TiDB åå°ä¼šæœ‰ä¸€äº›å®šæ—¶ä»»åŠ¡åœ¨ä¸æ–­åœ°å¼€å§‹äº‹åŠ¡æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œweek1 çš„çš„ä½œç”¨å°±ç®—å¤§åŠŸå‘Šæˆå•¦ã€‚å¸Œæœ›è‡ªå·±èƒ½åšæŒä¸‹æ¥ğŸ’ª~~~</p>
]]></content>
		</item>
		
		<item>
			<title>DNSå­¦ä¹ æ€»ç»“</title>
			<link>https://wangzeping722.github.io/posts/dns-recording/</link>
			<pubDate>Mon, 23 Dec 2019 10:36:05 +0800</pubDate>
			
			<guid>https://wangzeping722.github.io/posts/dns-recording/</guid>
			<description>DNS æœ‰å¤šç§è®°å½•ç±»å‹ï¼Œæ¯ç§è®°å½•éƒ½æœ‰ä¸åŒçš„ä½œç”¨ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ€»ç»“äº†å¸¸ç”¨çš„è®°å½•ã€‚ A Aï¼ˆAddressï¼‰è®°å½•ç”¨æ¥æŒ‡å®šä¸»æœºåï¼ˆåŸŸåï¼‰å¯¹åº”çš„ IPv4 åœ°å€è®°å½•ã€‚æ¯”</description>
			<content type="html"><![CDATA[<p>DNS æœ‰å¤šç§è®°å½•ç±»å‹ï¼Œæ¯ç§è®°å½•éƒ½æœ‰ä¸åŒçš„ä½œç”¨ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ€»ç»“äº†å¸¸ç”¨çš„è®°å½•ã€‚</p>
<h4 id="a">A</h4>
<p>Aï¼ˆAddressï¼‰è®°å½•ç”¨æ¥æŒ‡å®šä¸»æœºåï¼ˆåŸŸåï¼‰å¯¹åº”çš„ IPv4 åœ°å€è®°å½•ã€‚æ¯”å¦‚ï¼Œå½“ä½ æµè§ˆä¸€ä¸ªç½‘é¡µæ—¶å€™ä¼šï¼Œæµè§ˆå™¨å°±ä¼šå…ˆå»æŸ¥æ‰¾å¯¹åº”åŸŸåçš„ A è®°å½•ï¼Œæ¥è·å– IP åœ°å€ï¼Œè·å¾—äº† IP åœ°å€ï¼Œæ‰èƒ½ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä¸ºåŒä¸€ä¸ªåŸŸåæ·»åŠ å¤šä¸ª A è®°å½•ï¼Œè§£æçš„æ—¶å€™ï¼Œä¼šå¾—åˆ°å¤šä¸ª IPï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªä½¿ç”¨ã€‚</p>
</blockquote>
<p><em>åŸŸåä¸åŒºåˆ†å¤§å°å†™ã€‚è®°å½•çš„åç§°åº”è¯¥æ˜¯ç”± ASCII ç å­—æ¯ã€æ•°å­—å’Œ - ç»„æˆã€‚</em></p>
<h4 id="aaaa">AAAA</h4>
<p>AAAA è®°å½•ç”¨æ¥æŒ‡å®šä¸»æœºåï¼ˆåŸŸåï¼‰å¯¹åº”çš„ IPv6 åœ°å€è®°å½•ï¼Œå…¶ä»–ä¸ A ç›¸åŒã€‚</p>
<h4 id="cname-canonical-names">CNAME ï¼ˆcanonical namesï¼‰</h4>
<p>CNAMEï¼ˆè§„èŒƒåç§°ï¼‰ï¼Œä¹Ÿå°±æ˜¯åˆ«åè®°å½•ï¼Œå®ƒèƒ½å¤Ÿè®©æˆ‘ä»¬æŠŠå¤šä¸ªåå­—æ˜ å°„åˆ°åŒä¸€ä¸ªä¸»æœºã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ä½¿ç”¨ CDN æœåŠ¡æ—¶ã€‚</li>
<li>å‡å¦‚ä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œç€ 100 ä¸ªç½‘ç«™ï¼Œè¿™ 100 ä¸ªç½‘ç«™ CNAME åˆ° <code>a.example.com</code>ã€‚å½“è¯¥æœåŠ¡å™¨ IP æ”¹å˜æ—¶ï¼Œä½ åªéœ€æ”¹å˜ <code>a.example.com</code>çš„ IP å°±å¯ä»¥äº†ã€‚</li>
</ul>
<p>æ³¨æ„ï¼šç”±äº<code>CNAME</code>è®°å½•å°±æ˜¯ä¸€ä¸ªæ›¿æ¢ï¼Œæ‰€ä»¥åŸŸåä¸€æ—¦è®¾ç½®<code>CNAME</code>è®°å½•ä»¥åï¼Œå°±ä¸èƒ½å†è®¾ç½®å…¶ä»–è®°å½•äº†ï¼ˆæ¯”å¦‚<code>A</code>è®°å½•å’Œ<code>MX</code>è®°å½•ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢äº§ç”Ÿå†²çªã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ<code>foo.com</code>æŒ‡å‘<code>bar.com</code>ï¼Œè€Œä¸¤ä¸ªåŸŸåå„æœ‰è‡ªå·±çš„<code>MX</code>è®°å½•ï¼Œå¦‚æœä¸¤è€…ä¸ä¸€è‡´ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚ç”±äºé¡¶çº§åŸŸåé€šå¸¸è¦è®¾ç½®<code>MX</code>è®°å½•ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å…è®¸ç”¨æˆ·å¯¹é¡¶çº§åŸŸåè®¾ç½®<code>CNAME</code>è®°å½•ã€‚</p>
<p>Aè®°å½•æ˜¯æŠŠåŸŸåè§£æåˆ°IPåœ°å€ï¼Œè€ŒCNAMEè®°å½•æ˜¯æŠŠåŸŸåè§£æåˆ°å¦å¤–ä¸€ä¸ªåŸŸåï¼Œè€Œè¿™ä¸ªåŸŸåæœ€ç»ˆä¼šæŒ‡å‘Aè®°å½•ï¼Œåœ¨åŠŸèƒ½å®ç°åœ¨ä¸ŠAè®°å½•ä¸CNAMEè®°å½•æ²¡æœ‰åŒºåˆ«ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-dns" data-lang="dns">a.example.com       IN      A       192.168.1.101
b.example.com       IN      CNAME   a.example.comï¼ˆè§„èŒƒåç§°ï¼‰
</code></pre><p>ä½ åœ¨è¯·æ±‚ b.example.com çš„æ—¶å€™ï¼Œä»–ä¼šå…ˆè¿”å›ç»™ä½ ä¸€ä¸ª CNAME ï¼Œç„¶åä½ åœ¨ç”¨ CNAME å»æŸ¥è¯¢ã€‚</p>
<h4 id="ns">NS</h4>
<p>NSï¼ˆName Serverï¼‰ï¼ŒåŸŸåæœåŠ¡å™¨è®°å½•ï¼Œè¿”å›ä¿å­˜ä¸‹ä¸€çº§åŸŸåä¿¡æ¯çš„æœåŠ¡å™¨åœ°å€ã€‚è¯¥è®°å½•åªèƒ½è®¾ç½®ä¸ºåŸŸåï¼Œä¸èƒ½è®¾ç½®ä¸ºIPåœ°å€ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†æœåŠ¡çš„å®‰å…¨å¯é ï¼Œè‡³å°‘åº”è¯¥æœ‰ä¸¤æ¡<code>NS</code>è®°å½•ï¼Œè€Œ<code>A</code>è®°å½•å’Œ<code>MX</code>è®°å½•ä¹Ÿå¯ä»¥æœ‰å¤šæ¡ï¼Œè¿™æ ·å°±æä¾›äº†æœåŠ¡çš„å†—ä½™æ€§ï¼Œé˜²æ­¢å‡ºç°å•ç‚¹å¤±è´¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ dig NS google.com
google.com.		777	IN	NS	ns4.google.com.
google.com.		777	IN	NS	ns3.google.com.
google.com.		777	IN	NS	ns2.google.com.
google.com.		777	IN	NS	ns1.google.com.
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œgoogle çš„æƒå¨ NS æœåŠ¡å™¨æœ‰å››ä¸ªã€‚</p>
<h4 id="mx">MX</h4>
<p>MXï¼ˆMX recordï¼‰ï¼Œé‚®ä»¶äº¤æ¢è®°å½•ï¼Œç”¨äºé‚®ä»¶æœåŠ¡å™¨çš„åœ°å€ã€‚MX è®°å½•å…è®¸è®¾ç½®ä¼˜å…ˆçº§ï¼Œå½“å¤šä¸ªé‚®ä»¶æœåŠ¡å™¨å¯ç”¨æ—¶ï¼Œä¼šæ ¹æ®è¯¥å€¼å†³å®šæŠ•é€’é‚®ä»¶çš„æœåŠ¡å™¨ï¼ˆå€¼å°çš„ä¼˜å…ˆï¼‰ï¼Œä¸‹é¢çš„<code>20, 10, 40 ...</code>å°±è¡¨ç¤ºä¼˜å…ˆçº§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ dig MX google.com
google.com.		306	IN	MX	<span class="m">20</span> alt1.aspmx.l.google.com.
google.com.		306	IN	MX	<span class="m">10</span> aspmx.l.google.com.
google.com.		306	IN	MX	<span class="m">40</span> alt3.aspmx.l.google.com.
google.com.		306	IN	MX	<span class="m">30</span> alt2.aspmx.l.google.com.
google.com.		306	IN	MX	<span class="m">50</span> alt4.aspmx.l.google.com.
</code></pre></div><h4 id="soa">SOA</h4>
<p>SOA å«åšèµ·å§‹æˆæƒæœºæ„è®°å½•ï¼ŒNSç”¨äºæ ‡è¯†å¤šå°åŸŸåè§£ææœåŠ¡å™¨ï¼ŒSOAè®°å½•ç”¨äºåœ¨ä¼—å¤šNSè®°å½•ä¸­çš„<strong>ä¸»æœåŠ¡å™¨</strong>ã€‚SOA è®°å½•è¡¨ç¤ºæ­¤åŸŸåçš„æƒå¨è§£ææœåŠ¡å™¨åœ°å€ã€‚ å½“è¦æŸ¥è¯¢çš„åŸŸååœ¨æ‰€æœ‰é€’å½’è§£ææœåŠ¡å™¨ä¸­æ²¡æœ‰åŸŸåè§£æçš„ç¼“å­˜æ—¶ï¼Œå°±ä¼šå›æºæ¥è¯·æ±‚æ­¤åŸŸåçš„SOAè®°å½•ï¼Œä¹Ÿå«æƒå¨è§£æè®°å½•ã€‚</p>
<p>æ²¡æœ‰SOAè®°å½•çš„ zone ä¸ç¬¦åˆ RFC 1035 è¦æ±‚çš„æ ‡å‡†ã€‚</p>
<pre><code>$TTL 86400
@   IN  SOA     startech60serve root.startech60serve.com. (
        2018110201  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
        IN  NS      startech60serve
        IN  A       192.168.1.3
        IN  MX 10   startech60serve
startech60serve     IN  A       192.168.1.3
</code></pre><p><code>root.startech60serve.com. </code>å…¶ä¸­ç¬¬ä¸€ä¸ªç‚¹è¡¨ç¤ºæ˜¯@</p>
<h4 id="txt">TXT</h4>
<p>TXTï¼ˆTXT recordï¼‰ï¼Œæ–‡æœ¬è®°å½•ï¼Œä¸€èˆ¬ç”¨æ¥æè¿°ä¸€ä¸ªåŸŸåï¼Œæˆ–è€…ç”¨æ¥åšæŸç§éªŒè¯åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ dig TXT google.com
google.com.		300	IN	TXT	<span class="s2">&#34;docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e&#34;</span>
google.com.		3600	IN	TXT	<span class="s2">&#34;facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95&#34;</span>
google.com.		300	IN	TXT	<span class="s2">&#34;docusign=1b0a6754-49b1-4db5-8540-d2c12664b289&#34;</span>
google.com.		3600	IN	TXT	<span class="s2">&#34;globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=&#34;</span>
google.com.		3600	IN	TXT	<span class="s2">&#34;v=spf1 include:_spf.google.com ~all&#34;</span>
</code></pre></div><h4 id="ptr">PTR</h4>
<p>PTR è®°å½•æ˜¯ A è®°å½•çš„é€†å‘è®°å½•ï¼Œåˆç§°åš IP åæŸ¥è®°å½•æˆ–æŒ‡é’ˆè®°å½•ï¼Œè´Ÿè´£å°† IP åå‘è§£æä¸ºåŸŸåï¼Œå³åå‘åŸŸåè§£æã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://skyao.io/learning-dns/dns/">https://skyao.io/learning-dns/dns/</a></p>
<p><a href="https://deepzz.com/post/dns-recording-type.html">https://deepzz.com/post/dns-recording-type.html</a></p>
]]></content>
		</item>
		
		<item>
			<title>å¦‚ä½•è®¾è®¡ä¸å®ç° WebConsole</title>
			<link>https://wangzeping722.github.io/posts/how-to-write-webconsole/</link>
			<pubDate>Wed, 04 Dec 2019 09:13:51 +0800</pubDate>
			
			<guid>https://wangzeping722.github.io/posts/how-to-write-webconsole/</guid>
			<description>1. è°ƒç ” å‰ç«¯ï¼šäº†è§£åˆ°æœ‰ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„å¼€æºwebç»ˆç«¯åº“ï¼š xterm.js , ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚ åç«¯ï¼šä½¿ç”¨ go è¯­è¨€å®ç°ï¼Œå› ä¸º go è¯­è¨€æ‹¥æœ‰è®¸å¤šä¼˜ç§€çš„å¼€æºsshåº“ï¼Œèƒ½å¤Ÿ</description>
			<content type="html"><![CDATA[<h3 id="1-è°ƒç ”">1. è°ƒç ”</h3>
<p>å‰ç«¯ï¼šäº†è§£åˆ°æœ‰ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„å¼€æºwebç»ˆç«¯åº“ï¼š <strong>xterm.js</strong> , ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<p>åç«¯ï¼šä½¿ç”¨ go è¯­è¨€å®ç°ï¼Œå› ä¸º go è¯­è¨€æ‹¥æœ‰è®¸å¤šä¼˜ç§€çš„å¼€æºsshåº“ï¼Œèƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>éš¾ç‚¹ï¼š</p>
<pre><code>1. å¦‚ä½•ä¸ cf(cloud foundry) è¿›è¡Œäº¤äº’å¾—åˆ° `ssh code` ï¼Ÿ
2. å¦‚ä½•æŠŠ ssh å‘½ä»¤è¡Œè½¬æ¢æˆ websocket é€šè®¯, å¹¶è¾“å‡ºåˆ° xterm.js ä¸­ï¼Ÿ
3. å¦‚ä½•æ§åˆ¶è®¿é—®æƒé™ï¼Ÿ
</code></pre>
<h3 id="2-åŸç†">2. åŸç†</h3>
<p><img src="webconsole1.png" alt="webconsoleåŸç†å›¾"></p>
<p>â€‹	1. æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ· websocket è¯·æ±‚</p>
<p>â€‹	2. æœåŠ¡å™¨é€šè¿‡ ssh è¿æ¥åˆ° cf å®¹å™¨</p>
<p>â€‹	3. è¿æ¥å»ºç«‹ï¼ŒæœåŠ¡å™¨è´Ÿè´£è½¬å‘æ¶ˆæ¯</p>
<p>åœ¨åç«¯å’Œæµè§ˆå™¨ä¹‹é—´å»ºç«‹websocketè¿æ¥åï¼Œå°†ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„å‘½ä»¤é€šè¿‡ websocket åè®®å‘é€åˆ°åç«¯ï¼Œåç«¯ä½¿ç”¨ ssh åè®®å°†å‘½ä»¤è¾“å…¥åˆ°å®¹å™¨sshè¿›ç¨‹çš„ stdinï¼Œå‘½ä»¤æ‰§è¡Œåï¼Œå†ä» stdout ä¸­è¯»å–è¾“å‡ºï¼Œé€šè¿‡websocketåè®®è¿”å›æµè§ˆå™¨æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œè¾¾åˆ°äº¤äº’çš„ç›®çš„ã€‚</p>
<h3 id="3-é—®é¢˜è§£å†³ä»¥åŠæœåŠ¡ç«¯å®ç°">3. é—®é¢˜è§£å†³ä»¥åŠæœåŠ¡ç«¯å®ç°</h3>
<p>åœ¨å‰ä¸¤ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘å·²ç»é€šè¿‡åˆ†ææŠŠåŸç†å’Œéš¾ç‚¹æ¢³ç†æ¸…æ¥šäº†ï¼Œç›®å‰å°±éœ€è¦ç€æ‰‹è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<h4 id="31-å¦‚ä½•è·å–-ssh-code">3.1 å¦‚ä½•è·å– ssh code</h4>
<p>cf æœ‰ä¸€ä¸ªè‡ªå¸¦çš„å‘½ä»¤ <code>cf ssh-code</code> èƒ½å¤Ÿè·å–è¿æ¥åˆ°å®¹å™¨ç”¨çš„ <code>ssh code</code>ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰åœ¨ cf å¼€æºçš„ go è¯­è¨€å®¢æˆ·ç«¯ <code>cfclient</code> ä¸­å‘ç°ç›¸å…³çš„ APIï¼Œæ‰€ä»¥æˆ‘å»æŸ¥çœ‹äº† cf cli çš„æºç ï¼Œå¹¶åœ¨é‡Œé¢å‘ç°äº† <strong>cc</strong> æš´éœ²å‡ºæ¥çš„æ¥å£ï¼Œæœ‰äº†è¿™ä¸ªæ¥å£ä¹‹åï¼Œå°±èƒ½å¤Ÿé€šè¿‡ http è¯·æ±‚çš„æ–¹å¼è·å– <code>ssh-code</code>ã€‚ç”±äº <code>cfclient</code> ä¸­å¹¶æ²¡æœ‰ç›¸å…³çš„ä»£ç ï¼Œæ‰€ä»¥ä¸å¾—ä¸è‡ªå·±å®ç°ä¸€äº›æ–¹æ¥è·å– <code>ssh-code</code>, äºæ˜¯è¿™ä¸ªé—®é¢˜è§£å†³äº†ã€‚</p>
<h4 id="32-å¦‚ä½•å°†-websocket-å’Œ-ssh-è¿™ä¸¤ä¸ªåè®®çš„æ¶ˆæ¯è¿›è¡Œè½¬æ¢">3.2 å¦‚ä½•å°† websocket å’Œ ssh è¿™ä¸¤ä¸ªåè®®çš„æ¶ˆæ¯è¿›è¡Œè½¬æ¢</h4>
<p><strong>è¿æ¥å»ºç«‹</strong>ï¼š</p>
<p><img src="webconsole2.png" alt=""></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WS</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// åˆå§‹åŒ–websocketè¿æ¥
</span><span class="c1"></span>	<span class="nx">upgrader</span> <span class="o">:=</span> <span class="nx">websocket</span><span class="p">.</span><span class="nx">Upgrader</span><span class="p">{</span>
		<span class="nx">ReadBufferSize</span><span class="p">:</span>  <span class="mi">1024</span><span class="p">,</span>
		<span class="nx">WriteBufferSize</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">ws</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">upgrader</span><span class="p">.</span><span class="nf">Upgrade</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">ws</span><span class="p">.</span><span class="nf">Close</span><span class="p">(</span><span class="p">)</span>
  
	<span class="c1">// åˆå§‹åŒ–sshè¿æ¥
</span><span class="c1"></span>	<span class="nx">cl</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;claims&#34;</span><span class="p">)</span>
	<span class="nx">s</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;session&#34;</span><span class="p">)</span>
	<span class="nx">claims</span> <span class="o">:=</span> <span class="nx">cl</span><span class="p">.</span><span class="p">(</span><span class="o">*</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Claims</span><span class="p">)</span>
	<span class="nx">session</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="p">(</span><span class="o">*</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Session</span><span class="p">)</span>

	<span class="nx">sshShell</span> <span class="o">:=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">SSHShellSession</span><span class="p">{</span>
		<span class="nx">Node</span><span class="p">:</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">Node</span><span class="p">{</span>
			<span class="nx">Host</span><span class="p">:</span> <span class="nx">claims</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span>
			<span class="nx">Port</span><span class="p">:</span> <span class="nx">claims</span><span class="p">.</span><span class="nx">Port</span><span class="p">,</span>
		<span class="p">}</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="kd">var</span> <span class="nx">wsBuff</span> <span class="nx">WebSocketBufferWriter</span>
	<span class="nx">sshShell</span><span class="p">.</span><span class="nx">StdoutPipe</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">wsBuff</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">sshConn</span><span class="p">.</span><span class="nf">Connect</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">sshConn</span><span class="p">.</span><span class="nf">Close</span><span class="p">(</span><span class="p">)</span>
	<span class="k">defer</span> <span class="nx">wsBuff</span><span class="p">.</span><span class="nf">Flush</span><span class="p">(</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">TextMessage</span><span class="p">,</span> <span class="nx">ws</span><span class="p">)</span>
	<span class="o">...</span><span class="o">...</span>
  <span class="o">...</span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p><strong>è¿æ¥ä¿æŒï¼š</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">WS</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">...</span><span class="o">...</span>
  <span class="o">...</span><span class="o">...</span>
	<span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
	<span class="nx">setDone</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span> <span class="nx">done</span> <span class="o">&lt;-</span> <span class="kc">true</span> <span class="p">}</span>

	<span class="c1">// æ•°æ®è½¬æ¢ï¼šwebsocket ----&gt; SSH
</span><span class="c1"></span>	<span class="nx">writeMessageToSSHServer</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">wc</span> <span class="nx">io</span><span class="p">.</span><span class="nx">WriteCloser</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="nf">setDone</span><span class="p">(</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">{</span>
			<span class="c1">// ä»websocketè¯»å–æ•°æ®
</span><span class="c1"></span>			<span class="nx">msgType</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ws</span><span class="p">.</span><span class="nf">ReadMessage</span><span class="p">(</span><span class="p">)</span>

			<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nf">DispatchMessage</span><span class="p">(</span><span class="nx">sshShell</span><span class="p">.</span><span class="nx">Session</span><span class="p">,</span> <span class="nx">msgType</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">wc</span><span class="p">)</span><span class="p">;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Error: error write data to ssh server:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
				<span class="k">return</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="nx">stopper</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
	<span class="c1">// æ•°æ®è½¬æ¢ï¼šSSH ----&gt; websocket
</span><span class="c1"></span>	<span class="nx">writeBufferToWebSocket</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="nf">setDone</span><span class="p">(</span><span class="p">)</span>
		<span class="nx">tick</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">NewTicker</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Config</span><span class="p">.</span><span class="nx">SSH</span><span class="p">.</span><span class="nx">BufferCheckerCycleTime</span><span class="p">)</span><span class="p">)</span>
		<span class="k">defer</span> <span class="nx">tick</span><span class="p">.</span><span class="nf">Stop</span><span class="p">(</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">{</span>
			<span class="k">select</span> <span class="p">{</span>
			<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">tick</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
				<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">wsBuff</span><span class="p">.</span><span class="nf">Flush</span><span class="p">(</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">TextMessage</span><span class="p">,</span> <span class="nx">ws</span><span class="p">)</span><span class="p">;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
					<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Error: error sending data via webSocket:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
					<span class="k">return</span>
				<span class="p">}</span>
			<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopper</span><span class="p">:</span>
				<span class="k">return</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">go</span> <span class="nf">writeMessageToSSHServer</span><span class="p">(</span><span class="nx">sshShell</span><span class="p">.</span><span class="nx">StdinPipe</span><span class="p">)</span>
	<span class="k">go</span> <span class="nf">writeBufferToWebSocket</span><span class="p">(</span><span class="p">)</span>
	<span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="nf">setDone</span><span class="p">(</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">sshShell</span><span class="p">.</span><span class="nx">Session</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ssh exist from server&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span><span class="p">(</span><span class="p">)</span>

	<span class="o">&lt;-</span><span class="nx">done</span>
	<span class="nx">stopper</span> <span class="o">&lt;-</span> <span class="kc">true</span> 
	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Info: websocket finished!&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p><strong>æ§åˆ¶è®¿é—®æƒé™</strong>ï¼š</p>
<p>åˆ©ç”¨ cf è‡ªå¸¦çš„æƒé™è®¤è¯æœºåˆ¶å®ç°ã€‚</p>
]]></content>
		</item>
		
	</channel>
</rss>
